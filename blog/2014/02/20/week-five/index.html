
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Polina on Rails: Week Five - Somehow the Bee Flies</title>
  <meta name="author" content="Polina Soshnin">

  
  <meta name="description" content="Site with subscription billing using Stripe, and Recurly A web application with recurring billing using Stripe. This can be used for a membership &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://psoshnin.github.io/blog/2014/02/20/week-five/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Somehow the Bee Flies" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

	

<link href='http://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>

<!--<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Somehow the Bee Flies</a></h1>
  
    <h2>Polina's blog on the internet of things</h2>
  



<!-- Image Map  

<div class="imgmap_css_container" id="imgmap2014227154933">


<a style="position: absolute; top: 2px; left: 20px; width: 100px; height: 30px;"  alt="image-map-octopress" title="image-map-octopress" href="http://octopress.org/" target="" ></a>

<a style="position: absolute; top: 2px; left: 180px; width: 116px; height: 30px;"  alt="image-map-welcome" title="image-map-welcome" href="http://polina.io/about/" target="" >
</a>

<a style="position: absolute; top: 2px; left: 450px; width: 74px; height: 14px;"  alt="image-map-github" title="image-map-github" href="https://github.com/psoshnin" target="" ><em>github</em></a>

<a style="position: absolute; top: 2px; left: 600px; width: 200px; height: 12px;"  alt="image-map-twitter" title="image-map-twitter" href="https://twitter.com/907code" target="" ><em>twitter</em></a>

<a style="position: absolute; top: 4px; left: 800px; width: 96px; height: 12px;"  alt="image-map-linkedin" title="image-map-linkedin" href="http://www.linkedin.com/in/polinasoshnin" target="" ><em>linkedin</em></a>

</div> -->

</hgroup>
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:psoshnin.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

	<li><a href="/">Home</a></li>

  	<li><a href="/blog">Blog</a></li>
 
  	<li><a href="/code">Projects</a></li>
 
  	<li><a href="/about">About</a></li>
  	
  	<li><a href="/syllabus">Syllabus</a></li>
  	
	<!--<li><a href="/tags/">Tags</a></li> -->

  	<li><a href="/archives">Archives</a></li>

  	<!--<li><a href="/glossary">Glossary</a></li> -->
  
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Polina on Rails: Week Five</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-20T23:44:59-08:00" pubdate data-updated="true">Feb 20<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Site with subscription billing using Stripe, and Recurly</p>

<p>A web application with recurring billing using Stripe. This can be used for a membership site, subscription site, or a SaaS site (software as a service)</p>

<p>What I&rsquo;m going to use for this tutorial:</p>

<p>Stripe &mdash; recurring billing
Devise &mdash; user management and authentication
CanCan with Rolify for authorization (Rolify gives you role-based authorization)
Twitter Bootstrap &mdash; front end framework for CSS styling</p>

<p>Membership sites: restrict access to content</p>

<pre><code>Articles, videos, forums
</code></pre>

<p>SaaS limit use of web-based software</p>

<pre><code>Revenue model is the same: subscription based services, usually payed monthly
</code></pre>

<p>Basic functionality that all SaaS, membership, subscription based web applications need:</p>

<ul>
<li>Content/web functionality to deliver</li>
<li>Landing pages to convert visitors to paying customers</li>
<li>User management to register/remove users</li>
<li>access control to limit site wide access</li>
<li>authorization management to restrict access to content or services based on role or other characteristics</li>
<li>account management to maintain records/subscription status</li>
<li>recurring billing system for periodic payment transactions</li>
</ul>


<h4>Features my site will have:</h4>

<ul>
<li>tiered pricing for multiple subscription plans</li>
<li>optional &ldquo;free trial&rdquo; subscription</li>
<li>Stripe with no local cc storage</li>
<li>PCI compliance using Stripe JS library</li>
<li>Stripe for recurring billing, retries for payment failing, subscription cancelling</li>
<li>Paid subscriptions created after successful cc transactions</li>
<li>subscribers can upgrade/downgrade plans</li>
<li>subscribers can cancel subscription plans</li>
<li>configure the subscription renewal period (it defaults to one month)</li>
<li>administrator can change subscription plan or delete user</li>
</ul>


<h4>What I do not have:</h4>

<ul>
<li>Basecamp style subdomains (each user gets their own subdomain)</li>
<li>multitenancy database segmentation (using Apartment gem)</li>
</ul>


<h4>Architecture of application:</h4>

<ul>
<li>User management with Devise (register/remove users)</li>
<li>Authentication with Devise (login/logout)</li>
<li>Authorization management with CanCan and Rolify (access determined by role, in this case subscription plan)</li>
<li>account management to maintain records of subscription status</li>
<li>recurring billing with Stripe</li>
<li>landing pages</li>
<li>content or service pages</li>
</ul>


<p>How we&rsquo;re creating our account managment system: we need to keep subscription records: we&rsquo;ll combine Stripe for user management and Devise for our account management.</p>

<h4>Two ways to build a recurring billing system:</h4>

<ul>
<li><p>Build a complete billing managment system in your application. You would need to build a mechanism for checking for expiring subscriptions (daily cron job) and something to initiate payment requests through stripe when a user&rsquo;s account is due. This means you would only use Stripe for processing cc transactions.</p></li>
<li><p>Stripe provides complete recurring billing, so we&rsquo;ll use Stripe&rsquo;s API to supply a billing management system for us.</p></li>
</ul>


<h4>Key challenges/requirements</h4>

<ul>
<li><p>Make sure recurring billing and account managment are in sync. Stripe provides webhooks to make sure this happens. Stripe will initiate an HTTP request to our app and that will tell us we can change a subscription status.</p></li>
<li><p>PCI compliance: key requirement for any ecommerce site. This will minimize risk of customer cc exposure. Your website will meet PCI compliance if you accept payment information through the Stripe JS library and serve your payment page through SSL.</p></li>
</ul>


<p>Thinking through this problem as an engineer:</p>

<p>Software engineers attempt to model real-world objects and behavoirs in their applications and because of that they try to choose descriptive names for the objects and methods they use in order to reduce ambiguity and increase the understanding of the purpose of the application. In this example our most important object will be a &ldquo;User&rdquo; but it could also be an &ldquo;Account&rdquo; or a &ldquo;Member&rdquo;.</p>

<p>Attributes of the User:</p>

<pre><code>Important:
-email address
-password
-cc number/Stripe customer id number
- role id/subscription plan
    Role model supplied by Rolify gem

Less important:
-name
-creation date
-other meta data etc
</code></pre>

<p>All of these attributes could be in themselves separate objects that are associated through our user through a key/value pair. But in this application the attributes will just be attributes, not separate objects.</p>

<p>Instead of having a cc number in our application we&rsquo;re going to have a Stripe customer id that serves as an indirect reference to a credit card number. That will let us ask Stripe to bill the user.</p>

<h4>Accounts for this app:</h4>

<ul>
<li>Recurring billing: Stripe</li>
<li>Merchant account: a line of credit that allows a business to accept cc payments from its customers. A merchant account doesn&rsquo;t actually hold money. It&rsquo;s just a holding ground for cc payments.&ndash; Stripe</li>
<li>Hosting: Heroku</li>
<li>Email: Gmail</li>
<li>Source control repository: Git</li>
</ul>


<h4>SSL</h4>

<ul>
<li>wise to host any webapp that requires login through an ssl connection. This requires setting up SSL and applying for an SSL certificate if necessary</li>
</ul>


<h4>Infrastructure for email</h4>

<ul>
<li>company email</li>
<li>email sent from the app (&ldquo;transactional email&rdquo;)</li>
<li>broadcast email for newsletters and announcements</li>
</ul>


<p>There&rsquo;s no good answer for all three types. General I use Gmail for company email, Mandrill forTransactional email, and MailChimp for mailing list (marketing type emails).</p>

<p>git diff, hg diff</p>

<p>Domain registration: NameCheap</p>

<h4>Git workflow protips:</h4>

<p>If you&rsquo;re working commercially or on an open source project you should get in the habit of creating a git branch each time you begin work to implement a feature. When the new feature is complete you can merge the branch and squash the commits to your comrads see just one commit for the entire feature.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Polina Soshnin</span></span>

      








  


<time datetime="2014-02-20T23:44:59-08:00" pubdate data-updated="true">Feb 20<span>th</span>, 2014</time>
      


   
    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/02/19/a-short-guide-to-email-spoofing/" title="Previous Post: A short guide to email spoofing">&laquo; A short guide to email spoofing</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    


<section>
  <h1>About Me</h1>


  	<p>
  		Aspiring rubyist, pythonista. Lifelong Alaskan.  Love to xc ski and row.
  	</p>
  
  	<p>I'm an undergraduate living in Boston, MA, USA. I currently study Computer Science at 
  	<a href="http://www.wellesley.edu/cs">Wellesley College</a>.</p>
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/02/20/week-five/">Polina on Rails: Week Five</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/19/a-short-guide-to-email-spoofing/">A short guide to email spoofing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/19/week-four/">Polina on Rails: Week Four</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/13/week-three/">Polina on Rails: Week Three</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/07/week-two/">Polina on Rails: Week Two</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Built with &#x2661 by Polina -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. &copy; 2014 </span>
</p>

</footer>
  











</body>
</html>
